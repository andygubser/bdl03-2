{"paragraphs":[{"text":"%md\n# 610 Analysis 1\n\nWork with PySpark DF","user":"bd01","dateUpdated":"2021-02-05T10:19:05+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>610 Analysis 1</h1>\n<p>Work with PySpark DF</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1612518599608_-619980120","id":"20210127-071031_1944670894","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:19:05+0000","dateFinished":"2021-02-05T10:19:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:246"},{"text":"%md\n## Settings\n* Review active interpreters: md (needs to be on the top), spark2, sh, shUser\n* Review correct file to analyse in %sh and %spark2.pyspark\n\n## Approach\n* ","user":"bd01","dateUpdated":"2021-02-05T10:18:17+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Settings</h2>\n<ul>\n  <li>Review active interpreters: md (needs to be on the top), spark2, sh, shUser</li>\n  <li>Review correct file to analyse in %sh and %spark2.pyspark</li>\n</ul>\n<h2>Approach</h2>\n<p>*</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1612518599612_1665643401","id":"20210204-124753_933285857","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:17+0000","dateFinished":"2021-02-05T10:18:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:247"},{"text":"%sh\nDIR=/home/bd01/repos/project\nFILE='prep_household_data_1min_singleindex.csv'        #  1min granularity    # data for project\n# FILE='prep_household_data_15min_singleindex.csv'       # 15min granularity    # data for second prototype\n# FILE='prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototype\n\ncd $DIR\nls -lh\n\necho \"----hdfs----\"\nhdfs dfs -test -f $FILE      || hdfs dfs -put $DIR/$FILE .\nhdfs dfs -ls /user/$USER\n\n\n# BASE_URL=\"https://data.open-power-system-data.org/household_data/2020-04-15/\"\n\n# # blocksize (HDFS) is 8 MB\n\n\n\n\n\n","user":"bd01","dateUpdated":"2021-02-05T10:18:17+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"total 225M\n-rw-rw-r-- 1 bd01 bd01 111M Feb  4 21:18 prep_household_data_15min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01  84M Feb  5 08:20 prep_household_data_1min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01  31M Feb  5 07:39 prep_household_data_60min_singleindex.csv\n----hdfs----\nFound 11 items\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-01 12:12 /user/zeppelin/.sparkStaging\n-rw-r--r--   1 zeppelin hdfs    5757120 2021-02-04 13:29 /user/zeppelin/100-0.txt\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-02 09:18 /user/zeppelin/bank2\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-05 09:51 /user/zeppelin/conf\n-rw-r--r--   1 zeppelin hdfs  892027611 2021-02-03 14:52 /user/zeppelin/household_data_1min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs   15654559 2021-02-04 13:22 /user/zeppelin/household_data_60min_singleindex.csv\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-05 09:49 /user/zeppelin/notebook\n-rw-r--r--   1 zeppelin hdfs   87556096 2021-02-05 09:52 /user/zeppelin/prep_household_data_1min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs   31522045 2021-02-05 08:51 /user/zeppelin/prep_household_data_60min_singleindex.csv\ndrwxr-xr-x   - zeppelin hdfs          0 2021-01-28 11:18 /user/zeppelin/test\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-03 18:01 /user/zeppelin/zeppelin\n"}]},"apps":[],"jobName":"paragraph_1612518599615_662124212","id":"20210204-121023_149957682","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:17+0000","dateFinished":"2021-02-05T10:18:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:248"},{"text":"%md\n## Work with Spark DF\n\n\n### Data load into a Spark dataframe\n","user":"bd01","dateUpdated":"2021-02-05T10:18:22+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Work with Spark DF</h2>\n<h3>Data load into a Spark dataframe</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1612518599615_304364532","id":"20210204-135544_129249179","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:22+0000","dateFinished":"2021-02-05T10:18:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:249"},{"text":"%spark2.pyspark\nimport os\npath = '/home/bd01/repos/project'\n# file = 'prep_household_data_1min_singleindex.csv'        #  1min granularity    # data for project\n# file='prep_household_data_15min_singleindex.csv'       # 15min granularity    # data for second prototype\nfile = 'prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototypeos.chdir(path)\n\npathfile = 'hdfs:///user/{}/{}'.format(os.getenv(\"USER\"),file)\ndf = spark.read.csv(pathfile, header=True, inferSchema=False, sep=\",\")\n","user":"bd01","dateUpdated":"2021-02-05T10:18:22+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=195"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1612518599616_-378151707","id":"20210204-121027_1126578232","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:23+0000","dateFinished":"2021-02-05T10:18:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:250"},{"text":"%spark2.pyspark\n\n# print(\"df.show()\")\n# df.show()\n\nprint(\"df.printSchema\")\ndf.printSchema()","user":"bd01","dateUpdated":"2021-02-05T10:18:23+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"df.printSchema\nroot\n |-- _c0: string (nullable = true)\n |-- utc_timestamp: string (nullable = true)\n |-- cet_cest_timestamp: string (nullable = true)\n |-- interpolated: string (nullable = true)\n |-- unit: string (nullable = true)\n |-- dishwasher: string (nullable = true)\n |-- freezer: string (nullable = true)\n |-- grid_import: string (nullable = true)\n |-- heat_pump: string (nullable = true)\n |-- pv: string (nullable = true)\n |-- washing_machine: string (nullable = true)\n |-- circulation_pump: string (nullable = true)\n |-- grid_export: string (nullable = true)\n |-- refrigerator: string (nullable = true)\n |-- ev: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1612518599617_232792432","id":"20210204-121830_1414895971","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:24+0000","dateFinished":"2021-02-05T10:18:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:251"},{"text":"%md\n### Analysis","user":"bd01","dateUpdated":"2021-02-05T10:18:24+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Analysis</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1612518599618_367059017","id":"20210204-180003_1669074929","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:24+0000","dateFinished":"2021-02-05T10:18:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:252"},{"text":"%spark2.pyspark\n# Which is the highest energy consuming device?\n# calculating the average per hour of usage\n# ev = electic vehicle\n\nenergy_consumption = ['dishwasher', 'freezer', 'heat_pump', 'washing_machine', 'circulation_pump', 'refrigerator', 'ev']\nenergy_production = ['pv']\nenergy_trade = ['grid_import', 'grid_export']\n\nfor el in energy_consumption:\n    print(df.groupBy(\"unit\").agg(F.avg(el).alias(f\"avg_cons_{el}\")).orderBy(\"unit\").show())","user":"bd01","dateUpdated":"2021-02-05T10:18:24+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+-------------------+\n|        unit|avg_cons_dishwasher|\n+------------+-------------------+\n|residential0|               null|\n|residential1| 143.87328804039174|\n|residential2| 257.68314194627254|\n|residential3|   713.194695020105|\n|residential4|  71.16110641838375|\n+------------+-------------------+\n\nNone\n+------------+------------------+\n|        unit|  avg_cons_freezer|\n+------------+------------------+\n|residential0|              null|\n|residential1| 215.6069035359803|\n|residential2| 70.82580206809077|\n|residential3|268.15581511909994|\n|residential4|183.60990008872238|\n+------------+------------------+\n\nNone\n+------------+------------------+\n|        unit|avg_cons_heat_pump|\n+------------+------------------+\n|residential0|              null|\n|residential1|  4027.42658520761|\n|residential2|              null|\n|residential3|              null|\n|residential4|2090.7332596864135|\n+------------+------------------+\n\nNone\n+------------+------------------------+\n|        unit|avg_cons_washing_machine|\n+------------+------------------------+\n|residential0|                    null|\n|residential1|       155.6539067272492|\n|residential2|       192.6118911979968|\n|residential3|       999.0289662476246|\n|residential4|        77.8491507586888|\n+------------+------------------------+\n\nNone\n+------------+-------------------------+\n|        unit|avg_cons_circulation_pump|\n+------------+-------------------------+\n|residential0|                     null|\n|residential1|                     null|\n|residential2|        408.5000371790373|\n|residential3|        950.1816134899108|\n|residential4|                     null|\n+------------+-------------------------+\n\nNone\n+------------+---------------------+\n|        unit|avg_cons_refrigerator|\n+------------+---------------------+\n|residential0|                 null|\n|residential1|                 null|\n|residential2|                 null|\n|residential3|   259.24128257838294|\n|residential4|    92.36783082497222|\n+------------+---------------------+\n\nNone\n+------------+------------------+\n|        unit|       avg_cons_ev|\n+------------+------------------+\n|residential0|              null|\n|residential1|              null|\n|residential2|              null|\n|residential3|              null|\n|residential4|1165.3900046825731|\n+------------+------------------+\n\nNone\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=196","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=197","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=198","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=199","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=200","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=201","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=202"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1612518599619_-605157973","id":"20210205-091950_1378156004","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:24+0000","dateFinished":"2021-02-05T10:18:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:253"},{"text":"%spark2.pyspark\ndf_dishwasher_unit = df.groupBy(\"unit\").agg(F.avg(\"dishwasher\").alias(f\"avg\")).orderBy(\"unit\")\nz.show(df_dishwasher_unit)","user":"bd01","dateUpdated":"2021-02-05T10:23:13+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"unit":"string","avg":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"unit","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"avg","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"unit\tavg\nresidential0\tnull\nresidential1\t143.87328804039174\nresidential2\t257.68314194627254\nresidential3\t713.194695020105\nresidential4\t71.16110641838375\n"},{"type":"TEXT","data":"\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=203"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1612518599620_378625164","id":"20210205-093750_1858139033","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:36+0000","dateFinished":"2021-02-05T10:18:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:254"},{"text":"%md\nUsage of dishwasher shows a huge variation across households. While residential4 only uses 71kWh usage, the other households are much higher. Residential4 even uses ten-times more. Might be an indicator for household size, order of household size:\nResidential3 >> Residential2 > Residential1 > Residential4","user":"bd01","dateUpdated":"2021-02-05T10:19:56+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Usage of dishwasher shows a huge variation across households. While residential4 only uses 71kWh usage, the other households are much higher. Residential4 even uses ten-times more. Might be an indicator for household size, order of household size:<br/>Residential3 &gt;&gt; Residential2 &gt; Residential1 &gt; Residential4</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1612518599621_83779472","id":"20210205-091720_610091839","dateCreated":"2021-02-05T09:49:59+0000","dateStarted":"2021-02-05T10:18:38+0000","dateFinished":"2021-02-05T10:18:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"text":"%md\n  \n","user":"bd01","dateUpdated":"2021-02-05T10:18:38+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1612518599621_1875063278","id":"20210205-093710_823852557","dateCreated":"2021-02-05T09:49:59+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:256"}],"name":"MEP / wdgubser / 610 Analysis 1 - PySpark DF","id":"2FXX3NVZU","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"shUser:bd01:":[],"sh:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}