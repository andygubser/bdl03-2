{"paragraphs":[{"text":"%md\n# 610 Analysis 1 - Spark DF\n\n## Settings\n* Check the active interpreters: md (needs to be on the top), spark2, sh, shUser. \n* File for project: \n\n> FILE='prep_household_data_1min_singleindex.csv'\n\n## Approach\n* Download the data to local device. \n* Manipulate the data with Pandas (Pycharm).\n* Upload the data to the gateway. \n\n## Data Manipulation with Pandas\n> data_preprocessing.py","user":"bd01","dateUpdated":"2021-02-06T14:23:09+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>610 Analysis 1 - Spark DF</h1>\n<h2>Settings</h2>\n<ul>\n  <li>Check the active interpreters: md (needs to be on the top), spark2, sh, shUser.</li>\n  <li>File for project:</li>\n</ul>\n<blockquote>\n  <p>FILE=&lsquo;prep_household_data_1min_singleindex.csv&rsquo;</p>\n</blockquote>\n<h2>Approach</h2>\n<ul>\n  <li>Download the data to local device.</li>\n  <li>Manipulate the data with Pandas (Pycharm).</li>\n  <li>Upload the data to the gateway.</li>\n</ul>\n<h2>Data Manipulation with Pandas</h2>\n<blockquote>\n  <p>data_preprocessing.py</p>\n</blockquote>\n</div>"}]},"apps":[],"jobName":"paragraph_1612610402220_-1377535551","id":"20210204-124753_933285857","dateCreated":"2021-02-06T11:20:02+0000","dateStarted":"2021-02-06T14:23:09+0000","dateFinished":"2021-02-06T14:23:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:53"},{"text":"%sh\nDIR=/home/bd01/repos/project\nFILE='prep_household_data_1min_singleindex.csv'        #  1min granularity    # too small granularity for analysis\n# FILE='prep_household_data_15min_singleindex.csv'       # 15min granularity    # suited for project\n# FILE='prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototype\n\ncd $DIR\nls -lh\n\necho \"----hdfs----\"\n# hdfs dfs -rm -r /user/zeppelin/*\nhdfs dfs -test -f $FILE      || hdfs dfs -put $DIR/$FILE .\nhdfs dfs -ls /user/$USER\n\n","user":"bd01","dateUpdated":"2021-02-06T14:23:09+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"total 1.8G\n-rw-rw-r-- 1 bd01 bd01 119M Feb  5 19:02 prep_household_data_15min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01 1.6G Feb  5 19:00 prep_household_data_1min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01  34M Feb  5 18:56 prep_household_data_60min_singleindex.csv\n----hdfs----\nFound 6 items\ndrwx------   - zeppelin hdfs          0 2021-02-06 06:00 /user/zeppelin/.Trash\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-06 13:38 /user/zeppelin/conf\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-06 12:57 /user/zeppelin/notebook\n-rw-r--r--   1 zeppelin hdfs  124520554 2021-02-05 20:36 /user/zeppelin/prep_household_data_15min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs 1712423587 2021-02-06 11:26 /user/zeppelin/prep_household_data_1min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs   34626321 2021-02-05 20:35 /user/zeppelin/prep_household_data_60min_singleindex.csv\n"}]},"apps":[],"jobName":"paragraph_1612610402225_1992368120","id":"20210204-121023_149957682","dateCreated":"2021-02-06T11:20:02+0000","dateStarted":"2021-02-06T14:23:09+0000","dateFinished":"2021-02-06T14:23:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:54"},{"text":"%md\n## Load into a Spark dataframe\n","user":"bd01","dateUpdated":"2021-02-06T14:23:15+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Load into a Spark dataframe</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1612610402226_260652911","id":"20210204-135544_129249179","dateCreated":"2021-02-06T11:20:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:55","dateFinished":"2021-02-06T14:23:15+0000","dateStarted":"2021-02-06T14:23:15+0000"},{"text":"%spark2.pyspark\nimport os\npath = '/home/bd01/repos/project'\nfile = 'prep_household_data_1min_singleindex.csv'        #  1min granularity    # data for project\n# file = 'prep_household_data_15min_singleindex.csv'       # 15min granularity    # data for second prototype\n# file = 'prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototypeos.chdir(path)\n\npathfile = 'hdfs:///user/{}/{}'.format(os.getenv(\"USER\"),file)\ndf_read = spark.read.csv(pathfile, \n                    header=True, \n                    inferSchema=True, \n                    sep=\",\")\ndf_formatted = df_read.filter(df_read.unit != \"residential0\").\\\n                       withColumn('timestamp', F.unix_timestamp('cet_cest_timestamp', format).cast('timestamp')).\\\n                       withColumn('year', F.year('timestamp')).\\\n                       withColumn('date', F.to_date('timestamp')).\\\n                       withColumn('hour', F.hour('timestamp'))\ndf = df_formatted.na.drop(how='all', subset = ('dishwasher', 'freezer', 'grid_import', 'heat_pump', 'pv', 'washing_machine', \n                                               'circulation_pump', 'grid_export', 'refrigerator', 'ev'))\ndf.printSchema()\ndf.show()","user":"bd01","dateUpdated":"2021-02-06T14:23:15+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"msg":[{"data":"","type":"TEXT"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=568","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=569","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=570","http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=571"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1612610402226_-1455175037","id":"20210204-121027_1126578232","dateCreated":"2021-02-06T11:20:02+0000","dateStarted":"2021-02-06T14:23:15+0000","dateFinished":"2021-02-06T11:28:40+0000","status":"RUNNING","progressUpdateIntervalMs":500,"$$hashKey":"object:56","errorMessage":""},{"text":"%md\n### Analysis: Which devices consume the majority of households energy (average kWh)?","user":"bd01","dateUpdated":"2021-02-06T11:20:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Analysis: Which devices consume the majority of households energy (average kWh)?</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1612610402227_-601158637","id":"20210204-180003_1669074929","dateCreated":"2021-02-06T11:20:02+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:57"},{"text":"%spark2.pyspark\nenergy_consumption = ['dishwasher', 'freezer', 'heat_pump', 'washing_machine', 'circulation_pump', 'refrigerator', 'ev']\nenergy_production = ['pv']\nenergy_trade = ['grid_import', 'grid_export']\nenergy_all = energy_consumption + energy_production + energy_trade\n\nidx = ['unit', 'year']\nfactor = 60\ndf_gb_year = df.groupBy(idx).agg((F.avg('dishwasher')*factor)        .alias(\"yavg_kwh_dishwasher\"), \n                                 (F.avg('freezer')*factor)           .alias(\"yavg_kwh_freezer\"),\n                                 (F.avg('heat_pump')*factor)         .alias(\"yavg_kwh_heat_pump\"),\n                                 (F.avg('washing_machine')*factor)   .alias(\"yavg_kwh_washing_machine\"),\n                                 (F.avg('circulation_pump')*factor)  .alias(\"yavg_kwh_circulation_pump\"),\n                                 (F.avg('refrigerator')*factor)      .alias(\"yavg_kwh_refrigerator\"),\n                                 (F.avg('ev')*factor)                .alias(\"yavg_kwh_electric_vehicle\")). \\\n                                 orderBy(idx)\nz.show(df_gb_year)\n","user":"bd01","dateUpdated":"2021-02-06T14:22:35+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"unit":"string","year":"string","yavg_kwh_dishwasher":"string","yavg_kwh_freezer":"string","yavg_kwh_heat_pump":"string","yavg_kwh_washing_machine":"string","yavg_kwh_circulation_pump":"string","yavg_kwh_refrigerator":"string","yavg_kwh_electric_vehicle":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","isDateFormat":false}},"commonSetting":{},"keys":[{"name":"unit","index":0,"aggr":"sum"},{"name":"year","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"yavg_kwh_dishwasher","index":2,"aggr":"sum"},{"name":"yavg_kwh_freezer","index":3,"aggr":"sum"},{"name":"yavg_kwh_dishwasher","index":2,"aggr":"sum"},{"name":"yavg_kwh_electric_vehicle","index":8,"aggr":"sum"},{"name":"yavg_kwh_refrigerator","index":7,"aggr":"sum"},{"name":"yavg_kwh_circulation_pump","index":6,"aggr":"sum"},{"name":"yavg_kwh_washing_machine","index":5,"aggr":"sum"},{"name":"yavg_kwh_freezer","index":3,"aggr":"sum"},{"name":"yavg_kwh_dishwasher","index":2,"aggr":"sum"},{"name":"yavg_kwh_heat_pump","index":4,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"unit\tyear\tyavg_kwh_dishwasher\tyavg_kwh_freezer\tyavg_kwh_heat_pump\tyavg_kwh_washing_machine\tyavg_kwh_circulation_pump\tyavg_kwh_refrigerator\tyavg_kwh_electric_vehicle\nresidential1\t2015\t0.018764650121987227\t0.03236656721365821\t0.4099709032377887\t0.017519678555113938\tnull\tnull\tnull\nresidential1\t2016\t0.01656113387978142\t0.0344139344262295\t0.6430598816029144\t0.02120298269581056\tnull\tnull\tnull\nresidential1\t2017\t0.013252766024287998\t0.030842316074689315\t1.3842064059029031\t0.023626439433356596\tnull\tnull\tnull\nresidential2\t2015\t0.023346603131951287\t0.013985916376525204\tnull\t0.012580344143470657\t0.035477225319528204\tnull\tnull\nresidential2\t2016\t0.032082991803278685\t0.013250836868691211\tnull\t0.017580031876138432\t0.04584369307832422\tnull\tnull\nresidential2\t2017\t0.04170726795169803\tnull\tnull\t0.020123972602739723\t0.05224869192365932\tnull\tnull\nresidential2\t2018\tnull\tnull\tnull\t0.02105980659864086\tnull\tnull\tnull\nresidential3\t2014\t0.040635802469135805\t0.02925925925925926\tnull\t0.039401172960181086\t0.07150363561531074\t0.016707381278298412\tnull\nresidential3\t2015\t0.059971575342465756\t0.02269280821917808\tnull\t0.07376552511415524\t0.05653755707762556\t0.018148858447488585\tnull\nresidential3\t2016\t0.04005885701275045\t0.01744729052823315\tnull\t0.06273804644808743\t0.056186247723132965\t0.024999316939890714\tnull\nresidential3\t2017\t0.02472351598173517\t0.0\tnull\t0.05357739726027397\t0.0550142694063927\t0.02341382216021328\tnull\nresidential3\t2018\t0.027078740214397733\t0.0\tnull\t0.051319615814795744\t0.0423516858395707\tnull\tnull\nresidential4\t2015\t0.012744720344622283\t0.01887697116689578\t0.3988476206547419\t0.008966773190911876\tnull\t0.01552105137648711\t0.11495477826905398\nresidential4\t2016\t0.01049419398907104\t0.01855783242258652\t0.2956231785063752\t0.013536088342440803\tnull\t0.018566598360655738\t0.11547176684881605\nresidential4\t2017\t0.01313019390581718\t0.016504452054794526\t0.8671994752913853\t0.014265533722782787\tnull\t0.01614213197969553\t0.10690513698630137\nresidential4\t2018\tnull\t0.012833905980020236\tnull\tnull\tnull\tnull\t0.06619185700099284\n"},{"type":"TEXT","data":"\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cl-hpsec1-50-gw-01-lx-ub18.lxd:4040/jobs/job?id=542"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1612610402227_1381162670","id":"20210205-091950_1378156004","dateCreated":"2021-02-06T11:20:02+0000","dateStarted":"2021-02-06T11:34:34+0000","dateFinished":"2021-02-06T11:35:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:58"},{"text":"%md\nFirst analysis shows a large variability among the largest energy consumer household devices. Whereas heat pumps consume by far the largest amount of households energy, electric vehicles probably follow second. The  energy consumation of other factors such as dishwasher and freezer show huge variation across households. The usage of these devices depends on individual behaviour. Unfortunately, the data does not provide an indicator for household size or living area.\n","user":"bd01","dateUpdated":"2021-02-06T11:20:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>First analysis shows a large variability among the largest energy consumer household devices. Whereas heat pumps consume by far the largest amount of households energy, electric vehicles probably follow second. The energy consumation of other factors such as dishwasher and freezer show huge variation across households. The usage of these devices depends on individual behaviour. Unfortunately, the data does not provide an indicator for household size or living area.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1612610402228_-1981861590","id":"20210205-091720_610091839","dateCreated":"2021-02-06T11:20:02+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:59"},{"text":"","user":"bd01","dateUpdated":"2021-02-06T12:34:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1612613819513_-1675918664","id":"20210206-121659_924724685","dateCreated":"2021-02-06T12:16:59+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:60"}],"name":"MEP / wdgubser / 610 Analysis 1 - Spark DF","id":"2FXVEQ9ZS","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"shUser:bd01:":[],"sh:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}