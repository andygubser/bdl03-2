{"paragraphs":[{"text":"%md\n# 620 Analysis 2 - Spark SQL (Hive Metastore)\n\n## Settings\n* Review active interpreters: md (needs to be on the top), spark2, sh, shUser\n* Review correct file to analyse in %sh and %spark2.pyspark\n","user":"bd01","dateUpdated":"2021-02-07T14:22:04+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>620 Analysis 2 - Spark SQL (Hive Metastore)</h1>\n<h2>Settings</h2>\n<ul>\n  <li>Review active interpreters: md (needs to be on the top), spark2, sh, shUser</li>\n  <li>Review correct file to analyse in %sh and %spark2.pyspark</li>\n</ul>\n</div>"}]},"apps":[],"jobName":"paragraph_1612707521588_-1584665672","id":"20210204-124753_933285857","dateCreated":"2021-02-07T14:18:41+0000","dateStarted":"2021-02-07T14:22:04+0000","dateFinished":"2021-02-07T14:22:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:31499"},{"text":"%sh\nDIR=/home/bd01/repos/project\nFILE='prep_household_data_1min_singleindex.csv'        #  1min granularity    # data for project\n# FILE='prep_household_data_15min_singleindex.csv'       # 15min granularity    # data for second prototype\n# FILE='prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototype\n\ncd $DIR\nls -lh\n\necho \"----hdfs----\"\nhdfs dfs -test -f $FILE      || hdfs dfs -put $DIR/$FILE .\nhdfs dfs -ls /user/$USER","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"total 1.8G\n-rw-rw-r-- 1 bd01 bd01 119M Feb  5 19:02 prep_household_data_15min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01 1.6G Feb  5 19:00 prep_household_data_1min_singleindex.csv\n-rw-rw-r-- 1 bd01 bd01  34M Feb  5 18:56 prep_household_data_60min_singleindex.csv\n----hdfs----\nFound 6 items\ndrwx------   - zeppelin hdfs          0 2021-02-06 06:00 /user/zeppelin/.Trash\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-06 13:38 /user/zeppelin/conf\ndrwxr-xr-x   - zeppelin hdfs          0 2021-02-06 12:57 /user/zeppelin/notebook\n-rw-r--r--   1 zeppelin hdfs  124520554 2021-02-05 20:36 /user/zeppelin/prep_household_data_15min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs 1712423587 2021-02-06 11:26 /user/zeppelin/prep_household_data_1min_singleindex.csv\n-rw-r--r--   1 zeppelin hdfs   34626321 2021-02-05 20:35 /user/zeppelin/prep_household_data_60min_singleindex.csv\n"}]},"apps":[],"jobName":"paragraph_1612707521590_547119433","id":"20210204-121023_149957682","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31500"},{"text":"%spark2.pyspark\nimport os\nfrom pyspark.sql.types import (StructField, StringType,\n                               IntegerType, StructType,\n                               FloatType, DateType)\nimport pyspark.sql.functions as F\n\npath = '/home/bd01/repos/project'\nfile = 'prep_household_data_1min_singleindex.csv'        #  1min granularity    # data for project\n# file='prep_household_data_15min_singleindex.csv'       # 15min granularity    # data for second prototype\n# file = 'prep_household_data_60min_singleindex.csv'       # 60min granualrity    # data for prototypeos.chdir(path)\n\npathfile = 'hdfs:///user/{}/{}'.format(os.getenv(\"USER\"),file)\ndf = spark.read.csv(pathfile, header=True, inferSchema=True, sep=\",\")","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1612707521591_-310928254","id":"20210206-124539_1665669000","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31501"},{"text":"%spark2.pyspark\ndf.createOrReplaceTempView(\"energy_consumption\")\nspark.sql(\"DESCRIBE energy_consumption\").show()","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+---------+-------+\n|          col_name|data_type|comment|\n+------------------+---------+-------+\n|               _c0|      int|   null|\n|     utc_timestamp|timestamp|   null|\n|cet_cest_timestamp|   string|   null|\n|      interpolated|   string|   null|\n|              unit|   string|   null|\n|        dishwasher|   double|   null|\n|           freezer|   double|   null|\n|       grid_import|   double|   null|\n|         heat_pump|   double|   null|\n|                pv|   double|   null|\n|   washing_machine|   double|   null|\n|  circulation_pump|   double|   null|\n|       grid_export|   double|   null|\n|      refrigerator|   double|   null|\n|                ev|   double|   null|\n+------------------+---------+-------+\n\n"}]},"apps":[],"jobName":"paragraph_1612707521592_1179392881","id":"20210206-131913_1067809816","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31502"},{"text":"%spark2.pyspark\nquery = \"\"\"\n    SELECT hour(utc_timestamp) as hour, unit, sum(pv) as pv\n    FROM energy_consumption\n    WHERE pv > 0\n    group by unit, hour\n    order by unit, hour\n\"\"\"\ndf_pv = spark.sql(query)","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"hour":"string","unit":"string","sum(pv)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","forceY":true},"scatterChart":{"xAxis":{"name":"hour","index":0,"aggr":"sum"},"yAxis":{"name":"pv","index":4,"aggr":"sum"}},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"keys":[],"groups":[],"values":[],"commonSetting":{}},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1612707521593_-1116771883","id":"20210206-134102_1428659911","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31503"},{"text":"%spark2.pyspark\nz.show(df_pv)","user":"bd01","dateUpdated":"2021-02-07T16:46:57+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true},"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"hour":"string","unit":"string","pv":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{},"keys":[{"name":"hour","index":0,"aggr":"sum"}],"groups":[{"name":"unit","index":1,"aggr":"sum"}],"values":[{"name":"pv","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"hour\tunit\tpv\n3\tresidential1\t0.732000000002472\n4\tresidential1\t34.040000000006415\n5\tresidential1\t174.93900000001523\n6\tresidential1\t582.7679999999983\n7\tresidential1\t1159.1150000000202\n8\tresidential1\t1731.463000000018\n9\tresidential1\t2124.399999999998\n10\tresidential1\t2370.938999999983\n11\tresidential1\t2396.963000000005\n12\tresidential1\t2199.7010000000078\n13\tresidential1\t1652.7319999999697\n14\tresidential1\t1108.4250000000177\n15\tresidential1\t625.5199999999791\n16\tresidential1\t261.796999999993\n17\tresidential1\t79.84599999999702\n18\tresidential1\t18.299999999995617\n19\tresidential1\t0.1689999999931615\n0\tresidential3\t52.70600000000013\n1\tresidential3\t366.52599999999984\n3\tresidential3\t1.8750000000042064\n4\tresidential3\t41.779999999993436\n5\tresidential3\t211.88099999997667\n6\tresidential3\t502.8610000000317\n7\tresidential3\t845.3779999999822\n8\tresidential3\t1204.5950000000291\n9\tresidential3\t1497.9539999999924\n10\tresidential3\t1681.9489999999987\n11\tresidential3\t1754.1159999999995\n12\tresidential3\t1672.317000000011\n13\tresidential3\t1453.8469999999975\n14\tresidential3\t1119.6149999999911\n15\tresidential3\t730.3939999999716\n16\tresidential3\t372.8650000000028\n17\tresidential3\t135.27600000002215\n18\tresidential3\t27.045000000002005\n19\tresidential3\t0.6809999999941283\n3\tresidential4\t1.8040000000110012\n4\tresidential4\t39.234000000007654\n5\tresidential4\t148.16800000001598\n6\tresidential4\t426.29500000000303\n7\tresidential4\t1050.7480000000223\n8\tresidential4\t1879.2500000000075\n9\tresidential4\t2626.1709999999985\n10\tresidential4\t3203.406000000001\n11\tresidential4\t3425.221999999978\n12\tresidential4\t3476.058000000038\n13\tresidential4\t3128.288999999986\n14\tresidential4\t2448.3379999999725\n15\tresidential4\t1547.892000000011\n16\tresidential4\t821.8829999999928\n17\tresidential4\t304.9499999999789\n18\tresidential4\t47.14499999998861\n19\tresidential4\t1.5909999999867068\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1612707521594_-568572028","id":"20210206-193205_1390678484","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31504"},{"text":"%spark2.pyspark\nquery2 = \"\"\"\n    SELECT month(utc_timestamp) as month, unit, sum(pv)\n    FROM energy_consumption\n    where pv > 0\n    group by unit, month\n    order by unit, month\n\"\"\"\ndf_pv2 = spark.sql(query2)","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1612707521595_50129419","id":"20210205-102520_818361541","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31505"},{"text":"%spark2.pyspark\nz.show(df_pv2)","user":"bd01","dateUpdated":"2021-02-07T16:46:57+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","style":"stack"},"table":{"tableGridState":{"columns":[{"name":"month","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"unit","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"sum(pv)","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"month":"string","unit":"string","sum(pv)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true}},"commonSetting":{},"keys":[{"name":"month","index":0,"aggr":"sum"}],"groups":[{"name":"unit","index":1,"aggr":"sum"}],"values":[{"name":"sum(pv)","index":2,"aggr":"min"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"month\tunit\tsum(pv)\n1\tresidential1\t285.9299999999994\n2\tresidential1\t740.5639999999994\n3\tresidential1\t1076.0310000000009\n4\tresidential1\t999.1599999999999\n5\tresidential1\t1586.7959999999998\n6\tresidential1\t2691.397000000001\n7\tresidential1\t2862.8869999999993\n8\tresidential1\t2462.7550000000006\n9\tresidential1\t1810.575999999999\n10\tresidential1\t949.7139999999999\n11\tresidential1\t612.5699999999997\n12\tresidential1\t443.46900000000187\n1\tresidential3\t129.04800000000068\n2\tresidential3\t301.67100000000005\n3\tresidential3\t1013.5700000000008\n4\tresidential3\t1992.2849999999996\n5\tresidential3\t1950.9990000000003\n6\tresidential3\t2106.4080000000013\n7\tresidential3\t2148.0589999999993\n8\tresidential3\t1838.474999999999\n9\tresidential3\t1258.518000000001\n10\tresidential3\t526.9929999999986\n11\tresidential3\t245.63600000000088\n12\tresidential3\t161.9989999999989\n1\tresidential4\t966.1980000000003\n2\tresidential4\t1025.5480000000005\n3\tresidential4\t2049.212\n4\tresidential4\t2393.345000000001\n5\tresidential4\t2844.287999999998\n6\tresidential4\t2930.41\n7\tresidential4\t2925.1100000000015\n8\tresidential4\t2762.818\n9\tresidential4\t2222.542999999998\n10\tresidential4\t1890.879000000004\n11\tresidential4\t1360.8409999999967\n12\tresidential4\t1205.2519999999995\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1612707521596_-1628803958","id":"20210206-193802_578735280","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31506"},{"text":"%spark2.pyspark\n","user":"bd01","dateUpdated":"2021-02-07T14:18:41+0000","config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1612707521597_-1671419837","id":"20210206-193808_2144482201","dateCreated":"2021-02-07T14:18:41+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31507"}],"name":"MEP / wdgubser / 620 Analysis 2 - Spark SQL","id":"2FW1ETT1M","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"shUser:bd01:":[],"sh:shared_process":[],"jdbc:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}